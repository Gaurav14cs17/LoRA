<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 920 480" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.1"/>
    </filter>
    <marker id="arr" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748B"/>
    </marker>
    <marker id="arrDown" viewBox="0 0 10 10" refX="5" refY="9" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M 0 0 L 5 10 L 10 0 z" fill="#64748B"/>
    </marker>
  </defs>

  <rect width="920" height="480" rx="12" fill="#FAFBFC"/>

  <!-- Title -->
  <text x="460" y="36" text-anchor="middle" font-size="18" font-weight="700" fill="#1E293B">LoRA Training Pipeline — End to End</text>
  <line x1="200" y1="50" x2="720" y2="50" stroke="#E2E8F0" stroke-width="1"/>

  <!-- Step 1: Load Model -->
  <rect x="30" y="75" width="130" height="105" rx="10" fill="white" stroke="#3B82F6" stroke-width="2" filter="url(#shadow)"/>
  <circle cx="53" cy="92" r="10" fill="#3B82F6"/>
  <text x="53" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#FFF">1</text>
  <text x="105" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#1E293B">Load Base</text>
  <line x1="42" y1="105" x2="148" y2="105" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="95" y="122" text-anchor="middle" font-size="10" fill="#475569">FP16 or 4-bit</text>
  <text x="95" y="138" text-anchor="middle" font-size="10" fill="#475569">(QLoRA)</text>
  <text x="95" y="158" text-anchor="middle" font-size="10" fill="#3B82F6" font-family="'Cascadia Code', monospace">from_pretrained()</text>

  <line x1="160" y1="127" x2="180" y2="127" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 2: Configure -->
  <rect x="185" y="75" width="130" height="105" rx="10" fill="white" stroke="#8B5CF6" stroke-width="2" filter="url(#shadow)"/>
  <circle cx="208" cy="92" r="10" fill="#8B5CF6"/>
  <text x="208" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#FFF">2</text>
  <text x="260" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#1E293B">Configure</text>
  <line x1="197" y1="105" x2="303" y2="105" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="250" y="122" text-anchor="middle" font-size="10" fill="#475569">r = 16</text>
  <text x="250" y="138" text-anchor="middle" font-size="10" fill="#475569">alpha = 32</text>
  <text x="250" y="154" text-anchor="middle" font-size="10" fill="#475569">dropout = 0.05</text>
  <text x="250" y="170" text-anchor="middle" font-size="10" fill="#8B5CF6" font-family="'Cascadia Code', monospace">LoraConfig()</text>

  <line x1="315" y1="127" x2="335" y2="127" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 3: Prepare Data -->
  <rect x="340" y="75" width="130" height="105" rx="10" fill="white" stroke="#06B6D4" stroke-width="2" filter="url(#shadow)"/>
  <circle cx="363" cy="92" r="10" fill="#06B6D4"/>
  <text x="363" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#FFF">3</text>
  <text x="418" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#1E293B">Data Prep</text>
  <line x1="352" y1="105" x2="458" y2="105" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="405" y="122" text-anchor="middle" font-size="10" fill="#475569">Tokenize</text>
  <text x="405" y="138" text-anchor="middle" font-size="10" fill="#475569">Format prompts</text>
  <text x="405" y="154" text-anchor="middle" font-size="10" fill="#475569">Create labels</text>
  <text x="405" y="170" text-anchor="middle" font-size="10" fill="#06B6D4" font-family="'Cascadia Code', monospace">dataset.map()</text>

  <line x1="470" y1="127" x2="490" y2="127" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 4: Train -->
  <rect x="495" y="75" width="150" height="105" rx="10" fill="white" stroke="#F59E0B" stroke-width="2" filter="url(#shadow)"/>
  <circle cx="518" cy="92" r="10" fill="#F59E0B"/>
  <text x="518" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#FFF">4</text>
  <text x="580" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#1E293B">Train</text>
  <line x1="507" y1="105" x2="633" y2="105" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="570" y="120" text-anchor="middle" font-size="10" fill="#475569">LR = 2e-4, cosine</text>
  <text x="570" y="135" text-anchor="middle" font-size="10" fill="#475569">bf16 + grad checkpointing</text>
  <text x="570" y="150" text-anchor="middle" font-size="10" fill="#B45309" font-weight="600">Only A, B trained</text>
  <text x="570" y="170" text-anchor="middle" font-size="10" fill="#F59E0B" font-family="'Cascadia Code', monospace">trainer.train()</text>

  <line x1="645" y1="127" x2="665" y2="127" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 5: Save Adapter -->
  <rect x="670" y="75" width="115" height="105" rx="10" fill="white" stroke="#10B981" stroke-width="2" filter="url(#shadow)"/>
  <circle cx="693" cy="92" r="10" fill="#10B981"/>
  <text x="693" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#FFF">5</text>
  <text x="738" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#1E293B">Save</text>
  <line x1="682" y1="105" x2="773" y2="105" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="727" y="122" text-anchor="middle" font-size="10" fill="#475569">Adapter only</text>
  <text x="727" y="138" text-anchor="middle" font-size="10" fill="#065F46" font-weight="600">~10-50 MB</text>
  <text x="727" y="158" text-anchor="middle" font-size="10" fill="#10B981" font-family="'Cascadia Code', monospace">save_pretrained()</text>

  <line x1="785" y1="127" x2="805" y2="127" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 6: Deploy -->
  <rect x="810" y="75" width="95" height="105" rx="10" fill="white" stroke="#EF4444" stroke-width="2" filter="url(#shadow)"/>
  <circle cx="833" cy="92" r="10" fill="#EF4444"/>
  <text x="833" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#FFF">6</text>
  <text x="866" y="96" text-anchor="middle" font-size="11" font-weight="700" fill="#1E293B">Deploy</text>
  <line x1="822" y1="105" x2="893" y2="105" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="857" y="122" text-anchor="middle" font-size="10" fill="#475569">Merge or</text>
  <text x="857" y="138" text-anchor="middle" font-size="10" fill="#475569">serve with</text>
  <text x="857" y="154" text-anchor="middle" font-size="10" fill="#475569">adapter</text>
  <text x="857" y="170" text-anchor="middle" font-size="10" fill="#EF4444" font-family="'Cascadia Code', monospace">deploy</text>

  <!-- Deploy options section -->
  <rect x="30" y="210" width="860" height="245" rx="10" fill="white" stroke="#E2E8F0" stroke-width="1" filter="url(#shadow)"/>
  <text x="460" y="236" text-anchor="middle" font-size="14" font-weight="700" fill="#1E293B">Deployment Options (Step 6)</text>
  <line x1="60" y1="248" x2="860" y2="248" stroke="#E2E8F0" stroke-width="1"/>

  <!-- Option 1: Merge & Export -->
  <rect x="50" y="265" width="250" height="80" rx="8" fill="#F0F9FF" stroke="#BFDBFE" stroke-width="1"/>
  <text x="175" y="285" text-anchor="middle" font-size="12" font-weight="700" fill="#1E40AF">Merge &amp; Export</text>
  <text x="175" y="302" text-anchor="middle" font-size="10" fill="#475569" font-family="'Cascadia Code', monospace">merge_and_unload()</text>
  <text x="175" y="320" text-anchor="middle" font-size="10" fill="#64748B">→ Single model file</text>
  <text x="175" y="335" text-anchor="middle" font-size="10" fill="#94A3B8">Standard HF model, no LoRA needed</text>

  <!-- Option 2: vLLM / TGI -->
  <rect x="325" y="265" width="265" height="80" rx="8" fill="#FEF3C7" stroke="#FDE68A" stroke-width="1"/>
  <text x="457" y="285" text-anchor="middle" font-size="12" font-weight="700" fill="#92400E">Serve with Adapter</text>
  <text x="457" y="302" text-anchor="middle" font-size="10" fill="#475569">vLLM adapter stacking</text>
  <text x="457" y="320" text-anchor="middle" font-size="10" fill="#475569">TGI / SGLang</text>
  <text x="457" y="335" text-anchor="middle" font-size="10" fill="#94A3B8">Hot-swap adapters at runtime</text>

  <!-- Option 3: GGUF -->
  <rect x="615" y="265" width="260" height="80" rx="8" fill="#F0FDF4" stroke="#A7F3D0" stroke-width="1"/>
  <text x="745" y="285" text-anchor="middle" font-size="12" font-weight="700" fill="#065F46">Convert to GGUF</text>
  <text x="745" y="302" text-anchor="middle" font-size="10" fill="#475569">llama.cpp / ollama</text>
  <text x="745" y="320" text-anchor="middle" font-size="10" fill="#475569">Quantize: Q4_K_M, Q5_K_M</text>
  <text x="745" y="335" text-anchor="middle" font-size="10" fill="#94A3B8">Run on CPU / edge devices</text>

  <!-- Upload to Hub -->
  <rect x="50" y="360" width="825" height="40" rx="8" fill="#F5F3FF" stroke="#DDD6FE" stroke-width="1"/>
  <text x="462" y="384" text-anchor="middle" font-size="12" font-weight="600" fill="#7C3AED">Upload to HuggingFace Hub</text>
  <text x="462" y="396" text-anchor="middle" font-size="10" fill="#A78BFA">push_to_hub() — share adapter or merged model</text>

  <!-- Training config summary -->
  <rect x="50" y="415" width="825" height="38" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="0.5"/>
  <text x="80" y="435" font-size="11" fill="#1E293B" font-weight="600">Typical Config:</text>
  <text x="185" y="435" font-size="10" fill="#64748B">r=16 | α=32 | LR=2e-4 | cosine schedule | bf16 | grad_checkpointing | paged_adamw_8bit | 3 epochs</text>
  <text x="80" y="449" font-size="10" fill="#94A3B8">Trainable: ~0.09% of 7B params → adapters save to ~10-50 MB</text>
</svg>
