<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 420" font-family="Segoe UI,system-ui,sans-serif">
  <defs>
    <filter id="sh5" x="-3%" y="-3%" width="108%" height="108%"><feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.1"/></filter>
    <marker id="arr5" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#64748b"/></marker>
  </defs>
  <rect width="800" height="420" rx="16" fill="#fafbff" stroke="#e2e8f0" stroke-width="1.5"/>
  <text x="400" y="32" text-anchor="middle" font-size="18" font-weight="700" fill="#1e293b">LoRA Model Injection: Before and After</text>

  <rect x="30" y="55" width="340" height="330" rx="12" fill="#fef2f2" stroke="#dc2626" stroke-width="1.5"/>
  <text x="200" y="85" text-anchor="middle" font-size="14" font-weight="700" fill="#991b1b">BEFORE</text>

  <rect x="60" y="105" width="280" height="120" rx="10" fill="#f8fafc" stroke="#94a3b8" stroke-width="1"/>
  <text x="200" y="130" text-anchor="middle" font-size="11" font-weight="700" fill="#475569">model</text>
  <rect x="85" y="145" width="70" height="35" rx="6" fill="#fecaca" stroke="#dc2626" stroke-width="2"/>
  <text x="120" y="167" text-anchor="middle" font-size="9" font-weight="700" fill="#991b1b">q_proj</text>
  <rect x="170" y="145" width="70" height="35" rx="6" fill="#e5e7eb" stroke="#9ca3af" stroke-width="1"/>
  <text x="205" y="167" text-anchor="middle" font-size="9" font-weight="600" fill="#6b7280">o_proj</text>
  <rect x="255" y="145" width="70" height="35" rx="6" fill="#fecaca" stroke="#dc2626" stroke-width="2"/>
  <text x="290" y="167" text-anchor="middle" font-size="9" font-weight="700" fill="#991b1b">v_proj</text>
  <text x="200" y="215" text-anchor="middle" font-size="9" fill="#64748b">targets (red) = LoRA injection</text>

  <line x1="200" y1="230" x2="200" y2="250" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#arr5)"/>
  <text x="220" y="245" text-anchor="start" font-size="9" fill="#6366f1">_apply_lora()</text>
  <text x="220" y="258" text-anchor="start" font-size="8" fill="#64748b">recursive</text>

  <rect x="60" y="270" width="280" height="100" rx="10" fill="#f8fafc" stroke="#94a3b8" stroke-width="1"/>
  <text x="200" y="295" text-anchor="middle" font-size="10" font-weight="700" fill="#475569">model</text>
  <rect x="85" y="310" width="70" height="40" rx="6" fill="#bbf7d0" stroke="#16a34a" stroke-width="2"/>
  <text x="120" y="328" text-anchor="middle" font-size="8" font-weight="700" fill="#15803d">LoRA</text>
  <text x="120" y="342" text-anchor="middle" font-size="7" fill="#16a34a">q_proj</text>
  <rect x="170" y="310" width="70" height="40" rx="6" fill="#e5e7eb" stroke="#9ca3af" stroke-width="1"/>
  <text x="205" y="332" text-anchor="middle" font-size="9" font-weight="600" fill="#6b7280">o_proj</text>
  <rect x="255" y="310" width="70" height="40" rx="6" fill="#bbf7d0" stroke="#16a34a" stroke-width="2"/>
  <text x="290" y="328" text-anchor="middle" font-size="8" font-weight="700" fill="#15803d">LoRA</text>
  <text x="290" y="342" text-anchor="middle" font-size="7" fill="#16a34a">v_proj</text>

  <rect x="60" y="382" width="280" height="30" rx="6" fill="#ede9fe" stroke="#7c3aed" stroke-width="1"/>
  <text x="200" y="402" text-anchor="middle" font-size="9" fill="#6d28d9">q_proj, v_proj: A,B trainable; W&#8320; frozen</text>

  <rect x="395" y="55" width="15" height="120" rx="4" fill="#6366f1"/>
  <text x="402" y="120" text-anchor="middle" font-size="14" font-weight="800" fill="white">&#8594;</text>

  <rect x="430" y="55" width="340" height="330" rx="12" fill="#f0fdf4" stroke="#16a34a" stroke-width="1.5"/>
  <text x="600" y="85" text-anchor="middle" font-size="14" font-weight="700" fill="#15803d">AFTER</text>

  <rect x="455" y="105" width="280" height="120" rx="10" fill="#f8fafc" stroke="#94a3b8" stroke-width="1"/>
  <text x="595" y="130" text-anchor="middle" font-size="11" font-weight="700" fill="#475569">model</text>
  <rect x="480" y="145" width="100" height="60" rx="6" fill="#bbf7d0" stroke="#16a34a" stroke-width="2"/>
  <text x="530" y="165" text-anchor="middle" font-size="9" font-weight="700" fill="#15803d">LoRA</text>
  <text x="530" y="182" text-anchor="middle" font-size="7" fill="#16a34a">q_proj</text>
  <rect x="505" y="195" width="25" height="5" rx="1" fill="#86efac"/>
  <text x="530" y="202" text-anchor="middle" font-size="6" fill="#15803d">A,B</text>
  <rect x="545" y="145" width="70" height="35" rx="6" fill="#e5e7eb" stroke="#9ca3af" stroke-width="1"/>
  <text x="580" y="167" text-anchor="middle" font-size="9" font-weight="600" fill="#6b7280">o_proj</text>
  <rect x="630" y="145" width="100" height="60" rx="6" fill="#bbf7d0" stroke="#16a34a" stroke-width="2"/>
  <text x="680" y="165" text-anchor="middle" font-size="9" font-weight="700" fill="#15803d">LoRA</text>
  <text x="680" y="182" text-anchor="middle" font-size="7" fill="#16a34a">v_proj</text>
  <rect x="655" y="195" width="25" height="5" rx="1" fill="#86efac"/>
  <text x="680" y="202" text-anchor="middle" font-size="6" fill="#15803d">A,B</text>
  <text x="595" y="225" text-anchor="middle" font-size="9" fill="#64748b">green = LoRA wrapper with A,B sub-blocks</text>

  <rect x="455" y="245" width="280" height="140" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="1"/>
  <text x="595" y="270" text-anchor="middle" font-size="11" font-weight="700" fill="#15803d">Legend</text>
  <rect x="475" y="285" width="50" height="20" rx="4" fill="#fecaca" stroke="#dc2626"/>
  <text x="535" y="300" text-anchor="start" font-size="9" fill="#475569">target (injection point)</text>
  <rect x="475" y="310" width="50" height="20" rx="4" fill="#bbf7d0" stroke="#16a34a"/>
  <text x="535" y="325" text-anchor="start" font-size="9" fill="#475569">LoRA version</text>
  <rect x="475" y="335" width="50" height="20" rx="4" fill="#e5e7eb" stroke="#9ca3af"/>
  <text x="535" y="350" text-anchor="start" font-size="9" fill="#475569">unchanged (no LoRA)</text>
  <text x="595" y="372" text-anchor="middle" font-size="9" fill="#16a34a">W&#8320;: frozen; A,B: requires_grad=True</text>
</svg>