<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 920 600" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.1"/>
    </filter>
    <marker id="arr" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748B"/>
    </marker>
    <marker id="arrGreen" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#10B981"/>
    </marker>
    <marker id="arrBlue" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#3B82F6"/>
    </marker>
    <marker id="arrAmber" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#F59E0B"/>
    </marker>
  </defs>

  <rect width="920" height="600" rx="12" fill="#FAFBFC"/>

  <!-- Title -->
  <text x="460" y="36" text-anchor="middle" font-size="18" font-weight="700" fill="#1E293B">LoRAEmbedding &amp; LoRAConv2d — Data Flow Comparison</text>
  <line x1="160" y1="50" x2="760" y2="50" stroke="#E2E8F0" stroke-width="1"/>

  <!-- ====== LoRAEmbedding Section ====== -->
  <text x="230" y="80" text-anchor="middle" font-size="15" font-weight="700" fill="#10B981">LoRAEmbedding</text>
  <text x="230" y="96" text-anchor="middle" font-size="11" fill="#64748B">h = E₀[t] + (α/r) · A_E[t] @ B_E</text>

  <!-- Tokens input -->
  <rect x="30" y="120" width="100" height="50" rx="8" fill="#F1F5F9" stroke="#94A3B8" stroke-width="1.5"/>
  <text x="80" y="143" text-anchor="middle" font-size="13" font-weight="600" fill="#1E293B">Tokens</text>
  <text x="80" y="158" text-anchor="middle" font-size="10" fill="#64748B">[t₁, t₂, …, tₙ]</text>

  <!-- Fork -->
  <circle cx="170" cy="145" r="3" fill="#64748B"/>
  <line x1="130" y1="145" x2="170" y2="145" stroke="#64748B" stroke-width="1.5"/>

  <!-- Frozen E path -->
  <line x1="170" y1="145" x2="170" y2="125" stroke="#3B82F6" stroke-width="1.5"/>
  <line x1="170" y1="125" x2="210" y2="125" stroke="#3B82F6" stroke-width="1.5" marker-end="url(#arrBlue)"/>
  <rect x="215" y="108" width="120" height="36" rx="6" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1.5"/>
  <text x="275" y="130" text-anchor="middle" font-size="11" font-weight="600" fill="#1E40AF">W_emb (frozen)</text>
  <text x="312" y="120" font-size="8" fill="#3B82F6">❄️</text>

  <!-- LoRA A_E path -->
  <line x1="170" y1="145" x2="170" y2="175" stroke="#10B981" stroke-width="1.5"/>
  <line x1="170" y1="175" x2="210" y2="175" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrGreen)"/>
  <rect x="215" y="158" width="120" height="36" rx="6" fill="#ECFDF5" stroke="#10B981" stroke-width="1.5"/>
  <text x="275" y="175" text-anchor="middle" font-size="11" font-weight="600" fill="#065F46">A_emb (lookup)</text>
  <text x="275" y="188" text-anchor="middle" font-size="9" fill="#10B981">(V × r)</text>

  <!-- After frozen path -->
  <line x1="335" y1="126" x2="390" y2="126" stroke="#3B82F6" stroke-width="1.5"/>

  <!-- After A path — to B -->
  <line x1="335" y1="175" x2="355" y2="175" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrGreen)"/>
  <rect x="360" y="158" width="65" height="36" rx="6" fill="#ECFDF5" stroke="#10B981" stroke-width="1.5"/>
  <text x="392" y="175" text-anchor="middle" font-size="11" font-weight="600" fill="#065F46">@ B</text>
  <text x="392" y="188" text-anchor="middle" font-size="9" fill="#10B981">(r × d)</text>

  <!-- Scaling -->
  <line x1="425" y1="175" x2="435" y2="175" stroke="#10B981" stroke-width="1.5"/>
  <text x="440" y="173" font-size="10" fill="#065F46">× α/r</text>

  <!-- Sum -->
  <circle cx="415" cy="145" r="16" fill="#F0FDF4" stroke="#10B981" stroke-width="2"/>
  <text x="415" y="150" text-anchor="middle" font-size="16" font-weight="700" fill="#10B981">+</text>
  <line x1="390" y1="126" x2="400" y2="136" stroke="#3B82F6" stroke-width="1.5"/>
  <line x1="415" y1="159" x2="415" y2="161" stroke="#10B981" stroke-width="1.5"/>

  <!-- Output -->
  <line x1="431" y1="145" x2="445" y2="145" stroke="#10B981" stroke-width="1.5"/>
  <rect x="447" y="128" width="50" height="36" rx="6" fill="#F0FDF4" stroke="#10B981" stroke-width="1.5"/>
  <text x="472" y="150" text-anchor="middle" font-size="13" font-weight="700" fill="#065F46">h</text>

  <!-- Embedding note -->
  <rect x="30" y="210" width="460" height="30" rx="5" fill="#ECFDF5" stroke="#A7F3D0" stroke-width="0.5"/>
  <text x="50" y="229" font-size="11" fill="#065F46">Key: A_emb is looked up per-token (discrete input), B is a shared projection matrix</text>

  <!-- ====== LoRAConv2d Section ====== -->
  <text x="230" y="280" text-anchor="middle" font-size="15" font-weight="700" fill="#F59E0B">LoRAConv2d</text>
  <text x="230" y="296" text-anchor="middle" font-size="11" fill="#64748B">h = Conv₀(x) + (α/r) · B ∘ Conv_A(x)</text>

  <!-- Feature map input -->
  <rect x="30" y="315" width="100" height="55" rx="8" fill="#F1F5F9" stroke="#94A3B8" stroke-width="1.5"/>
  <text x="80" y="337" text-anchor="middle" font-size="12" font-weight="600" fill="#1E293B">Feature</text>
  <text x="80" y="351" text-anchor="middle" font-size="12" font-weight="600" fill="#1E293B">Map</text>
  <text x="80" y="365" text-anchor="middle" font-size="10" fill="#64748B">(C_in,H,W)</text>

  <!-- Fork -->
  <circle cx="170" cy="342" r="3" fill="#64748B"/>
  <line x1="130" y1="342" x2="170" y2="342" stroke="#64748B" stroke-width="1.5"/>

  <!-- Frozen conv path -->
  <line x1="170" y1="342" x2="170" y2="318" stroke="#3B82F6" stroke-width="1.5"/>
  <line x1="170" y1="318" x2="210" y2="318" stroke="#3B82F6" stroke-width="1.5" marker-end="url(#arrBlue)"/>
  <rect x="215" y="301" width="130" height="36" rx="6" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1.5"/>
  <text x="280" y="323" text-anchor="middle" font-size="11" font-weight="600" fill="#1E40AF">Conv2d W₀ (frozen)</text>
  <text x="322" y="313" font-size="8" fill="#3B82F6">❄️</text>

  <!-- LoRA Conv_A path -->
  <line x1="170" y1="342" x2="170" y2="375" stroke="#F59E0B" stroke-width="1.5"/>
  <line x1="170" y1="375" x2="210" y2="375" stroke="#F59E0B" stroke-width="1.5" marker-end="url(#arrAmber)"/>
  <rect x="215" y="356" width="130" height="42" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1.5"/>
  <text x="280" y="375" text-anchor="middle" font-size="11" font-weight="600" fill="#92400E">Conv_A (1×1)</text>
  <text x="280" y="391" text-anchor="middle" font-size="9" fill="#B45309">C_in → rank channels</text>

  <!-- After frozen path -->
  <line x1="345" y1="319" x2="400" y2="319" stroke="#3B82F6" stroke-width="1.5"/>

  <!-- After Conv_A — to B matmul -->
  <line x1="345" y1="377" x2="358" y2="377" stroke="#F59E0B" stroke-width="1.5" marker-end="url(#arrAmber)"/>
  <rect x="363" y="356" width="100" height="42" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1.5"/>
  <text x="413" y="375" text-anchor="middle" font-size="11" font-weight="600" fill="#92400E">B (matmul)</text>
  <text x="413" y="391" text-anchor="middle" font-size="9" fill="#B45309">(r × C_out) + permute</text>

  <!-- Scaling -->
  <line x1="463" y1="377" x2="468" y2="377" stroke="#F59E0B" stroke-width="1"/>
  <text x="472" y="375" font-size="10" fill="#92400E">× α/r</text>

  <!-- Sum -->
  <circle cx="425" cy="342" r="16" fill="#FFFBEB" stroke="#F59E0B" stroke-width="2"/>
  <text x="425" y="348" text-anchor="middle" font-size="16" font-weight="700" fill="#F59E0B">+</text>
  <line x1="400" y1="319" x2="410" y2="329" stroke="#3B82F6" stroke-width="1.5"/>
  <line x1="425" y1="356" x2="425" y2="358" stroke="#F59E0B" stroke-width="1.5"/>

  <!-- Output -->
  <line x1="441" y1="342" x2="455" y2="342" stroke="#F59E0B" stroke-width="1.5"/>
  <rect x="457" y="324" width="50" height="36" rx="6" fill="#FFFBEB" stroke="#F59E0B" stroke-width="1.5"/>
  <text x="482" y="346" text-anchor="middle" font-size="13" font-weight="700" fill="#92400E">h</text>

  <!-- Conv note -->
  <rect x="30" y="415" width="460" height="30" rx="5" fill="#FFFBEB" stroke="#FDE68A" stroke-width="0.5"/>
  <text x="50" y="434" font-size="11" fill="#92400E">Key: Spatial structure preserved. Conv_A handles spatial dims, B is a pointwise channel mixer</text>

  <!-- ====== Comparison Table ====== -->
  <rect x="530" y="80" width="370" height="380" rx="10" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1" filter="url(#shadow)"/>
  <text x="715" y="108" text-anchor="middle" font-size="14" font-weight="700" fill="#1E293B">Comparison</text>
  <line x1="550" y1="118" x2="880" y2="118" stroke="#E2E8F0" stroke-width="1"/>

  <!-- Table headers -->
  <text x="560" y="140" font-size="11" font-weight="700" fill="#64748B">Aspect</text>
  <text x="680" y="140" font-size="11" font-weight="700" fill="#10B981">Embedding</text>
  <text x="810" y="140" font-size="11" font-weight="700" fill="#F59E0B">Conv2d</text>
  <line x1="550" y1="148" x2="880" y2="148" stroke="#E2E8F0" stroke-width="0.5"/>

  <!-- Row 1 -->
  <text x="560" y="168" font-size="11" fill="#475569">Input type</text>
  <text x="680" y="168" font-size="11" fill="#065F46">Integer IDs</text>
  <text x="810" y="168" font-size="11" fill="#92400E">Float tensor</text>
  <line x1="550" y1="178" x2="880" y2="178" stroke="#E2E8F0" stroke-width="0.3"/>

  <!-- Row 2 -->
  <text x="560" y="198" font-size="11" fill="#475569">A access</text>
  <text x="680" y="198" font-size="11" fill="#065F46">Row lookup</text>
  <text x="810" y="198" font-size="11" fill="#92400E">Convolution</text>
  <line x1="550" y1="208" x2="880" y2="208" stroke="#E2E8F0" stroke-width="0.3"/>

  <!-- Row 3 -->
  <text x="560" y="228" font-size="11" fill="#475569">A shape</text>
  <text x="680" y="228" font-size="11" fill="#065F46">(V × r)</text>
  <text x="810" y="228" font-size="11" fill="#92400E">(r, C_in, k, k)</text>
  <line x1="550" y1="238" x2="880" y2="238" stroke="#E2E8F0" stroke-width="0.3"/>

  <!-- Row 4 -->
  <text x="560" y="258" font-size="11" fill="#475569">B shape</text>
  <text x="680" y="258" font-size="11" fill="#065F46">(r × d)</text>
  <text x="810" y="258" font-size="11" fill="#92400E">(r × C_out)</text>
  <line x1="550" y1="268" x2="880" y2="268" stroke="#E2E8F0" stroke-width="0.3"/>

  <!-- Row 5 -->
  <text x="560" y="288" font-size="11" fill="#475569">Spatial?</text>
  <text x="680" y="288" font-size="11" fill="#065F46">No</text>
  <text x="810" y="288" font-size="11" fill="#92400E">Yes (preserved)</text>
  <line x1="550" y1="298" x2="880" y2="298" stroke="#E2E8F0" stroke-width="0.3"/>

  <!-- Row 6 -->
  <text x="560" y="318" font-size="11" fill="#475569">Dropout?</text>
  <text x="680" y="318" font-size="11" fill="#065F46">Not applied</text>
  <text x="810" y="318" font-size="11" fill="#92400E">On LoRA path</text>
  <line x1="550" y1="328" x2="880" y2="328" stroke="#E2E8F0" stroke-width="0.3"/>

  <!-- Shared pattern box -->
  <rect x="550" y="340" width="330" height="50" rx="6" fill="#F0F9FF" stroke="#BFDBFE" stroke-width="0.5"/>
  <text x="565" y="360" font-size="11" font-weight="600" fill="#1E293B">Shared Pattern</text>
  <text x="565" y="378" font-size="11" fill="#475569">h = h_base + (α/r) × LoRA_delta</text>
  <text x="740" y="378" font-size="11" fill="#475569">Frozen base + trainable low-rank update</text>

  <!-- Legend -->
  <rect x="530" y="470" width="370" height="35" rx="6" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="0.5"/>
  <rect x="548" y="482" width="12" height="12" rx="2" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1"/>
  <text x="566" y="492" font-size="10" fill="#64748B">Frozen</text>
  <rect x="628" y="482" width="12" height="12" rx="2" fill="#ECFDF5" stroke="#10B981" stroke-width="1"/>
  <text x="646" y="492" font-size="10" fill="#64748B">Embedding LoRA</text>
  <rect x="748" y="482" width="12" height="12" rx="2" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
  <text x="766" y="492" font-size="10" fill="#64748B">Conv2d LoRA</text>
</svg>
