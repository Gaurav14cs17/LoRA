<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 920 520" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.1"/>
    </filter>
    <marker id="arr" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748B"/>
    </marker>
  </defs>

  <rect width="920" height="520" rx="12" fill="#FAFBFC"/>

  <!-- Title -->
  <text x="460" y="36" text-anchor="middle" font-size="18" font-weight="700" fill="#1E293B">QLoRA — 4-bit Quantized Base + LoRA Adapters</text>
  <text x="460" y="54" text-anchor="middle" font-size="12" fill="#64748B">Fine-tune a 7B model on a single RTX 3090 (~6 GB VRAM)</text>
  <line x1="160" y1="68" x2="760" y2="68" stroke="#E2E8F0" stroke-width="1"/>

  <!-- Step 1: Load in 4-bit -->
  <rect x="30" y="90" width="270" height="230" rx="10" fill="white" stroke="#3B82F6" stroke-width="2" filter="url(#shadow)"/>
  <rect x="30" y="90" width="270" height="36" rx="10" fill="#3B82F6"/>
  <rect x="30" y="116" width="270" height="10" fill="#3B82F6"/>
  <circle cx="55" cy="108" r="11" fill="#2563EB"/>
  <text x="55" y="112" text-anchor="middle" font-size="12" font-weight="700" fill="#FFF">1</text>
  <text x="175" y="113" text-anchor="middle" font-size="13" font-weight="700" fill="#FFF">Load in 4-bit</text>

  <text x="50" y="148" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">BitsAndBytesConfig(</text>
  <text x="60" y="166" font-size="11" fill="#1E40AF" font-family="'Cascadia Code', monospace">load_in_4bit=True,</text>
  <text x="60" y="184" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">bnb_4bit_quant_type</text>
  <text x="60" y="200" font-size="11" fill="#1E40AF" font-family="'Cascadia Code', monospace">  = "nf4",</text>
  <text x="60" y="218" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">bnb_4bit_compute_dtype</text>
  <text x="60" y="234" font-size="11" fill="#1E40AF" font-family="'Cascadia Code', monospace">  = bfloat16,</text>
  <text x="60" y="252" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">bnb_4bit_use_double_quant</text>
  <text x="60" y="268" font-size="11" fill="#1E40AF" font-family="'Cascadia Code', monospace">  = True</text>
  <text x="50" y="286" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">)</text>

  <!-- Weight representation diagram -->
  <rect x="50" y="293" width="230" height="20" rx="4" fill="#DBEAFE"/>
  <text x="165" y="307" text-anchor="middle" font-size="10" fill="#1E40AF">Weights stored as NF4 (4 bits per param)</text>

  <!-- Arrow 1-2 -->
  <line x1="300" y1="205" x2="330" y2="205" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 2: Apply LoRA -->
  <rect x="335" y="90" width="250" height="230" rx="10" fill="white" stroke="#10B981" stroke-width="2" filter="url(#shadow)"/>
  <rect x="335" y="90" width="250" height="36" rx="10" fill="#10B981"/>
  <rect x="335" y="116" width="250" height="10" fill="#10B981"/>
  <circle cx="360" cy="108" r="11" fill="#059669"/>
  <text x="360" y="112" text-anchor="middle" font-size="12" font-weight="700" fill="#FFF">2</text>
  <text x="470" y="113" text-anchor="middle" font-size="13" font-weight="700" fill="#FFF">Apply LoRA</text>

  <text x="355" y="148" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">LoraConfig(</text>
  <text x="365" y="166" font-size="11" fill="#065F46" font-family="'Cascadia Code', monospace">r=64,</text>
  <text x="365" y="184" font-size="11" fill="#065F46" font-family="'Cascadia Code', monospace">lora_alpha=16,</text>
  <text x="365" y="202" font-size="11" fill="#065F46" font-family="'Cascadia Code', monospace">target="all-linear",</text>
  <text x="365" y="220" font-size="11" fill="#065F46" font-family="'Cascadia Code', monospace">dropout=0.1</text>
  <text x="355" y="238" font-size="11" fill="#475569" font-family="'Cascadia Code', monospace">)</text>

  <!-- Adapter precision note -->
  <rect x="355" y="252" width="210" height="15" rx="3" fill="#ECFDF5"/>
  <text x="460" y="263" text-anchor="middle" font-size="9" fill="#059669">LoRA adapters in fp16/bf16 precision</text>

  <!-- Layer diagram -->
  <rect x="355" y="273" width="210" height="40" rx="6" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="0.5"/>
  <rect x="365" y="280" width="65" height="25" rx="4" fill="#DBEAFE" stroke="#3B82F6" stroke-width="0.8"/>
  <text x="397" y="297" text-anchor="middle" font-size="9" fill="#1E40AF">4-bit W₀</text>
  <text x="440" y="297" font-size="12" fill="#64748B">+</text>
  <rect x="455" y="280" width="35" height="25" rx="4" fill="#FEF3C7" stroke="#F59E0B" stroke-width="0.8"/>
  <text x="472" y="297" text-anchor="middle" font-size="9" fill="#92400E">A</text>
  <rect x="498" y="280" width="35" height="25" rx="4" fill="#FEF3C7" stroke="#F59E0B" stroke-width="0.8"/>
  <text x="515" y="297" text-anchor="middle" font-size="9" fill="#92400E">B</text>
  <text x="545" y="297" font-size="8" fill="#10B981">fp16</text>

  <!-- Arrow 2-3 -->
  <line x1="585" y1="205" x2="615" y2="205" stroke="#64748B" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Step 3: Train -->
  <rect x="620" y="90" width="270" height="230" rx="10" fill="white" stroke="#F59E0B" stroke-width="2" filter="url(#shadow)"/>
  <rect x="620" y="90" width="270" height="36" rx="10" fill="#F59E0B"/>
  <rect x="620" y="116" width="270" height="10" fill="#F59E0B"/>
  <circle cx="645" cy="108" r="11" fill="#D97706"/>
  <text x="645" y="112" text-anchor="middle" font-size="12" font-weight="700" fill="#FFF">3</text>
  <text x="765" y="113" text-anchor="middle" font-size="13" font-weight="700" fill="#FFF">Train</text>

  <text x="640" y="148" font-size="11" fill="#475569">Optimizer:</text>
  <text x="720" y="148" font-size="11" fill="#92400E" font-weight="600">paged_adamw_8bit</text>
  <text x="640" y="168" font-size="11" fill="#475569">Gradient checkpointing:</text>
  <text x="810" y="168" font-size="11" fill="#92400E" font-weight="600">enabled</text>
  <text x="640" y="188" font-size="11" fill="#475569">Compute dtype:</text>
  <text x="745" y="188" font-size="11" fill="#92400E" font-weight="600">bf16</text>

  <line x1="640" y1="200" x2="870" y2="200" stroke="#FDE68A" stroke-width="0.5"/>
  <text x="640" y="220" font-size="11" fill="#78350F">Only LoRA params updated</text>
  <text x="640" y="240" font-size="11" fill="#78350F">4-bit W₀ dequantized on-the-fly</text>
  <text x="640" y="260" font-size="11" fill="#78350F">for forward/backward passes</text>

  <rect x="640" y="275" width="230" height="30" rx="5" fill="#FFFBEB" stroke="#FDE68A" stroke-width="0.5"/>
  <text x="755" y="295" text-anchor="middle" font-size="10" fill="#92400E">~1.2% trainable parameters</text>

  <!-- Memory comparison -->
  <rect x="30" y="350" width="860" height="145" rx="10" fill="white" stroke="#E2E8F0" stroke-width="1" filter="url(#shadow)"/>
  <text x="460" y="378" text-anchor="middle" font-size="14" font-weight="700" fill="#1E293B">GPU Memory Comparison — LLaMA-7B</text>
  <line x1="60" y1="390" x2="860" y2="390" stroke="#E2E8F0" stroke-width="1"/>

  <!-- Full FT bar -->
  <text x="60" y="418" font-size="12" font-weight="600" fill="#64748B">Full Fine-Tuning</text>
  <rect x="200" y="405" width="640" height="22" rx="4" fill="#FEE2E2" stroke="#FCA5A5" stroke-width="0.5"/>
  <text x="520" y="420" text-anchor="middle" font-size="11" font-weight="600" fill="#B91C1C">~120 GB — requires 4× A100 80GB</text>

  <!-- LoRA fp16 bar -->
  <text x="60" y="448" font-size="12" font-weight="600" fill="#64748B">LoRA fp16</text>
  <rect x="200" y="435" width="171" height="22" rx="4" fill="#DBEAFE" stroke="#93C5FD" stroke-width="0.5"/>
  <text x="286" y="450" text-anchor="middle" font-size="11" font-weight="600" fill="#1E40AF">~32 GB — 1× A100</text>

  <!-- QLoRA bar -->
  <text x="60" y="478" font-size="12" font-weight="700" fill="#10B981">QLoRA 4-bit</text>
  <rect x="200" y="465" width="32" height="22" rx="4" fill="#A7F3D0" stroke="#6EE7B7" stroke-width="0.5"/>
  <text x="245" y="480" font-size="11" font-weight="700" fill="#065F46">~6 GB — RTX 3090!</text>
</svg>
